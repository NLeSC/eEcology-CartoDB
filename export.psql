CREATE TEMPORARY TABLE cartodb_projects (key_name varchar);
INSERT INTO cartodb_projects VALUES ('HG_TEXEL'),('LBBG_TEXEL'),('HB_VELUWE'),('EF_ALLEGRANZA');
\copy (SELECT abbr, english_name, latin_name, species_id FROM gps.ee_species_limited) TO 'ee_species_limited.csv'
\copy (SELECT ring_number, species_latin_name, colour_ring, mass, remarks, sex, start_date, end_date, individual_id FROM gps.ee_individual_limited WHERE ring_number IN (SELECT ring_number FROM gps.ee_track_session_limited JOIN cartodb_projects USING (key_name))) TO 'ee_individual_limited.csv'
\copy (SELECT key_name, station_name, start_date, end_date, description, project_id, parent_id FROM gps.ee_project_limited WHERE key_name IN (SELECT key_name FROM cartodb_projects)) TO 'ee_project_limited.csv'
\copy (SELECT device_info_serial, firmware_version, mass, start_date, end_date, x_o, x_s, y_o, y_s, z_o, z_s, tracker_id FROM gps.ee_tracker_limited WHERE device_info_serial IN (SELECT device_info_serial FROM gps.ee_track_session_limited JOIN cartodb_projects USING (key_name))) TO 'ee_tracker_limited.csv'
\copy (SELECT key_name, device_info_serial, ring_number, start_date, end_date, start_latitude, start_longitude, remarks, track_session_id, project_id, tracker_id, individual_id FROM gps.ee_track_session_limited JOIN cartodb_projects USING (key_name)) TO 'ee_track_session_limited.csv'
\copy (SELECT location AS the_geom, ST_Transform(location, 3857) AS the_geom_webmercator, device_info_serial, date_time, latitude, longitude, altitude, pressure, temperature, satellites_used, gps_fixtime, positiondop, h_accuracy, v_accuracy, x_speed, y_speed, z_speed, speed_accuracy,  speed_3d, speed_2d, direction, altitude_agl FROM gps.ee_tracking_speed_limited WHERE userflag!=1 AND longitude IS NOT NULL AND latitude IS NOT NULL AND device_info_serial IN (SELECT device_info_serial FROM gps.ee_track_session_limited JOIN cartodb_projects USING (key_name))) to program 'gzip -c > ee_tracking_speed_limited.csv.gz'
